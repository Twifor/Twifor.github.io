
<!DOCTYPE html>
<html lang="en">


  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#202020" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>

    
        <meta name="keywords" content="" />
        

          
              <meta name="description"
                content="科大讯飞杯NowCoder5278" />
              

                <link rel="icon" type="image/x-icon" href="/logo.ico">
                <title>
                  科大讯飞杯NowCoder5278lyh&#39;s blog
                </title>
                
                  <!-- stylesheets list from config.yml -->
                  
                    <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
                    
                    <link rel="stylesheet" href="/css/xoxo.css">
                    
                      
  <meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div class="nav-container">
    <nav class="home-menu pure-menu pure-menu-horizontal">
  <a class="pure-menu-heading" href="/">
    <span class="title">
      lyh&#39;s blog
    </span>
  </a>

  <ul class="pure-menu-list clearfix">
    
      
          <li class="pure-menu-item"><a href="/" class="pure-menu-link">
              Home
            </a></li>
          
            
      
          <li class="pure-menu-item"><a href="/archives" class="pure-menu-link">
              Archives
            </a></li>
          
            
      
          <li class="pure-menu-item"><a href="/tags" class="pure-menu-link">
              Tags
            </a></li>
          
            
      
          <li class="pure-menu-item"><a href="/search" class="pure-menu-link">
              Search
            </a></li>
          
            
      
          <li class="pure-menu-item"><a href="/about" class="pure-menu-link">
              About
            </a></li>
          
            
  </ul>

</nav>
  </div>

  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
      <div class="post-container">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        科大讯飞杯NowCoder5278
      </h1>
      <span>
        
          <time class="time" datetime="2020-04-21T10:31:25.000Z">
            2020-04-21
          </time>
          
      </span>
      <span class="slash">/</span>
      <span class="post-meta">
        <span class="post-tags">
          
        </span>
      </span>
      <!-- <span class="slash">/</span> -->
      <!-- <span class="read">
      <span id="busuanzi_value_page_pv"></span> 点击
    </span> -->
      <span class="slash">/</span>
      <span class="read">阅读耗时 41 分钟</span>
    </header>

    <div class="post-content">
      <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a target="_blank" rel="noopener" href="https://ac.nowcoder.com/acm/contest/5278">“科大讯飞杯”第18届上海大学程序设计联赛春季赛暨高校网络友谊赛</a>题解。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;共12题，5小时，难度不高的比赛。<br><span id="more"></span></p>
<h3 id="A、组队比赛"><a href="#A、组队比赛" class="headerlink" title="A、组队比赛"></a>A、组队比赛</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;给定四个整数，两两分组，最小化组间差距。一共就3种情况，算一遍即可。签到题。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a, b, c, d;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;a, &amp;b, &amp;c, &amp;d);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, <span class="built_in">min</span>(<span class="built_in">min</span>(<span class="built_in">abs</span>(a + c - b - d), <span class="built_in">abs</span>(a + b - c - d)), <span class="built_in">abs</span>(a + d - b - c)));</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="B、每日一报"><a href="#B、每日一报" class="headerlink" title="B、每日一报"></a>B、每日一报</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;多元排序，写好排序函数，一遍sort即过。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> date;</span><br><span class="line">    <span class="type">int</span> num;</span><br><span class="line">    <span class="type">double</span> tw;</span><br><span class="line">&#125; op[<span class="number">500</span>];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(Node a, Node b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.date != b.date) <span class="keyword">return</span> a.date &gt; b.date;</span><br><span class="line">    <span class="keyword">if</span> (a.tw != b.tw) <span class="keyword">return</span> a.tw &gt; b.tw;</span><br><span class="line">    <span class="keyword">return</span> a.num &lt; b.num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="type">int</span> s = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%lf&quot;</span>, &amp;op[s].date, &amp;op[s].num, &amp;op[s].tw);</span><br><span class="line">        <span class="keyword">if</span> (op[s].tw &gt;= <span class="number">38.0</span>) ++s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(op + <span class="number">1</span>, op + s, cmp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, s - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; s; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d %.1lf\n&quot;</span>, op[i].date, op[i].num, op[i].tw);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="C、最长非公共子序列"><a href="#C、最长非公共子序列" class="headerlink" title="C、最长非公共子序列"></a>C、最长非公共子序列</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当两者长度不等时，答案就是较长的那一个串。当长度相同时，考虑两个串是否相等，若相等，则不存在符合题意的串，否则就是两者其中之一。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">char</span> s1[<span class="number">5005</span>], s2[<span class="number">5005</span>];</span><br><span class="line"><span class="type">int</span> l1, l2;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, s1, s2);</span><br><span class="line">    l1 = <span class="built_in">strlen</span>(s1), l2 = <span class="built_in">strlen</span>(s2);</span><br><span class="line">    <span class="keyword">if</span> (l1 != l2) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, <span class="built_in">max</span>(l1, l2));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s1, s2) == <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, l1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="D、最大字符集"><a href="#D、最大字符集" class="headerlink" title="D、最大字符集"></a>D、最大字符集</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;按长度讨论。对于$n$为1、2时的情况很容易求出答案，对于$n$更大的情况，考虑形如$01\cdots 10$（或$10\cdots 01$）的串，它们必然不会出现某一个串是另一串子串的问题，并且长度任意选（除了长度为1的），因此其余的答案也容易得到。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;1\n0&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;2\n0\n11&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, n - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i - <span class="number">2</span>; j++) <span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="E、美味的序列"><a href="#E、美味的序列" class="headerlink" title="E、美味的序列"></a>E、美味的序列</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;正着反着都来一遍答案就有了，全场第二简单题。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> op[<span class="number">100005</span>], n;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, op + i);</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>, s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        s += op[i] - i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = s;</span><br><span class="line">    s = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">reverse</span>(op + <span class="number">1</span>, op + n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        s += op[i] - i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = <span class="built_in">max</span>(ans, s);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, ans);</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h3 id="F、日期小助手"><a href="#F、日期小助手" class="headerlink" title="F、日期小助手"></a>F、日期小助手</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;模拟题，需要考虑闰年，还有考虑一些英语问题。总而言之就是没有多少思维性，纯肝向的题目。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最简单的方式是打一个表，然后在里面直接找出日期。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* MQ[] = &#123;<span class="string">&quot;2000514&quot;</span>, <span class="string">&quot;2001513&quot;</span>, <span class="string">&quot;2002512&quot;</span>, <span class="string">&quot;2003511&quot;</span>, <span class="string">&quot;2004509&quot;</span>, <span class="string">&quot;2005508&quot;</span>, <span class="string">&quot;2006514&quot;</span>, <span class="string">&quot;2007513&quot;</span>, <span class="string">&quot;2008511&quot;</span>, <span class="string">&quot;2009510&quot;</span>, <span class="string">&quot;2010509&quot;</span>, <span class="string">&quot;2011508&quot;</span>, <span class="string">&quot;2012513&quot;</span>, <span class="string">&quot;2013512&quot;</span>, <span class="string">&quot;2014511&quot;</span>, <span class="string">&quot;2015510&quot;</span>, <span class="string">&quot;2016508&quot;</span>, <span class="string">&quot;2017514&quot;</span>, <span class="string">&quot;2018513&quot;</span>, <span class="string">&quot;2019512&quot;</span>, <span class="string">&quot;2020510&quot;</span>, <span class="string">&quot;2021509&quot;</span>, <span class="string">&quot;2022508&quot;</span>, <span class="string">&quot;2023514&quot;</span>, <span class="string">&quot;2024512&quot;</span>, <span class="string">&quot;2025511&quot;</span>, <span class="string">&quot;2026510&quot;</span>, <span class="string">&quot;2027509&quot;</span>, <span class="string">&quot;2028514&quot;</span>, <span class="string">&quot;2029513&quot;</span>, <span class="string">&quot;2030512&quot;</span>, <span class="string">&quot;2031511&quot;</span>, <span class="string">&quot;2032509&quot;</span>, <span class="string">&quot;2033508&quot;</span>, <span class="string">&quot;2034514&quot;</span>, <span class="string">&quot;2035513&quot;</span>, <span class="string">&quot;2036511&quot;</span>, <span class="string">&quot;2037510&quot;</span>, <span class="string">&quot;2038509&quot;</span>, <span class="string">&quot;2039508&quot;</span>, <span class="string">&quot;2040513&quot;</span>, <span class="string">&quot;2041512&quot;</span>, <span class="string">&quot;2042511&quot;</span>, <span class="string">&quot;2043510&quot;</span>, <span class="string">&quot;2044508&quot;</span>, <span class="string">&quot;2045514&quot;</span>, <span class="string">&quot;2046513&quot;</span>, <span class="string">&quot;2047512&quot;</span>, <span class="string">&quot;2048510&quot;</span>, <span class="string">&quot;2049509&quot;</span>, <span class="string">&quot;2050508&quot;</span>, <span class="string">&quot;2051514&quot;</span>, <span class="string">&quot;2052512&quot;</span>, <span class="string">&quot;2053511&quot;</span>, <span class="string">&quot;2054510&quot;</span>, <span class="string">&quot;2055509&quot;</span>, <span class="string">&quot;2056514&quot;</span>, <span class="string">&quot;2057513&quot;</span>, <span class="string">&quot;2058512&quot;</span>, <span class="string">&quot;2059511&quot;</span>, <span class="string">&quot;2060509&quot;</span>, <span class="string">&quot;2061508&quot;</span>, <span class="string">&quot;2062514&quot;</span>, <span class="string">&quot;2063513&quot;</span>, <span class="string">&quot;2064511&quot;</span>, <span class="string">&quot;2065510&quot;</span>, <span class="string">&quot;2066509&quot;</span>, <span class="string">&quot;2067508&quot;</span>, <span class="string">&quot;2068513&quot;</span>, <span class="string">&quot;2069512&quot;</span>, <span class="string">&quot;2070511&quot;</span>, <span class="string">&quot;2071510&quot;</span>, <span class="string">&quot;2072508&quot;</span>, <span class="string">&quot;2073514&quot;</span>, <span class="string">&quot;2074513&quot;</span>, <span class="string">&quot;2075512&quot;</span>, <span class="string">&quot;2076510&quot;</span>, <span class="string">&quot;2077509&quot;</span>, <span class="string">&quot;2078508&quot;</span>, <span class="string">&quot;2079514&quot;</span>, <span class="string">&quot;2080512&quot;</span>, <span class="string">&quot;2081511&quot;</span>, <span class="string">&quot;2082510&quot;</span>, <span class="string">&quot;2083509&quot;</span>, <span class="string">&quot;2084514&quot;</span>, <span class="string">&quot;2085513&quot;</span>, <span class="string">&quot;2086512&quot;</span>, <span class="string">&quot;2087511&quot;</span>, <span class="string">&quot;2088509&quot;</span>, <span class="string">&quot;2089508&quot;</span>, <span class="string">&quot;2090514&quot;</span>, <span class="string">&quot;2091513&quot;</span>, <span class="string">&quot;2092511&quot;</span>, <span class="string">&quot;2093510&quot;</span>, <span class="string">&quot;2094509&quot;</span>, <span class="string">&quot;2095508&quot;</span>, <span class="string">&quot;2096513&quot;</span>, <span class="string">&quot;2097512&quot;</span>, <span class="string">&quot;2098511&quot;</span>, <span class="string">&quot;2099510&quot;</span>, <span class="string">&quot;2100509&quot;</span>, <span class="string">&quot;2101508&quot;</span>, <span class="string">&quot;2102514&quot;</span>, <span class="string">&quot;2103513&quot;</span>, <span class="string">&quot;2104511&quot;</span>, <span class="string">&quot;2105510&quot;</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* FQ[] = &#123;<span class="string">&quot;2000618&quot;</span>, <span class="string">&quot;2001617&quot;</span>, <span class="string">&quot;2002616&quot;</span>, <span class="string">&quot;2003615&quot;</span>, <span class="string">&quot;2004620&quot;</span>, <span class="string">&quot;2005619&quot;</span>, <span class="string">&quot;2006618&quot;</span>, <span class="string">&quot;2007617&quot;</span>, <span class="string">&quot;2008615&quot;</span>, <span class="string">&quot;2009621&quot;</span>, <span class="string">&quot;2010620&quot;</span>, <span class="string">&quot;2011619&quot;</span>, <span class="string">&quot;2012617&quot;</span>, <span class="string">&quot;2013616&quot;</span>, <span class="string">&quot;2014615&quot;</span>, <span class="string">&quot;2015621&quot;</span>, <span class="string">&quot;2016619&quot;</span>, <span class="string">&quot;2017618&quot;</span>, <span class="string">&quot;2018617&quot;</span>, <span class="string">&quot;2019616&quot;</span>, <span class="string">&quot;2020621&quot;</span>, <span class="string">&quot;2021620&quot;</span>, <span class="string">&quot;2022619&quot;</span>, <span class="string">&quot;2023618&quot;</span>, <span class="string">&quot;2024616&quot;</span>, <span class="string">&quot;2025615&quot;</span>, <span class="string">&quot;2026621&quot;</span>, <span class="string">&quot;2027620&quot;</span>, <span class="string">&quot;2028618&quot;</span>, <span class="string">&quot;2029617&quot;</span>, <span class="string">&quot;2030616&quot;</span>, <span class="string">&quot;2031615&quot;</span>, <span class="string">&quot;2032620&quot;</span>, <span class="string">&quot;2033619&quot;</span>, <span class="string">&quot;2034618&quot;</span>, <span class="string">&quot;2035617&quot;</span>, <span class="string">&quot;2036615&quot;</span>, <span class="string">&quot;2037621&quot;</span>, <span class="string">&quot;2038620&quot;</span>, <span class="string">&quot;2039619&quot;</span>, <span class="string">&quot;2040617&quot;</span>, <span class="string">&quot;2041616&quot;</span>, <span class="string">&quot;2042615&quot;</span>, <span class="string">&quot;2043621&quot;</span>, <span class="string">&quot;2044619&quot;</span>, <span class="string">&quot;2045618&quot;</span>, <span class="string">&quot;2046617&quot;</span>, <span class="string">&quot;2047616&quot;</span>, <span class="string">&quot;2048621&quot;</span>, <span class="string">&quot;2049620&quot;</span>, <span class="string">&quot;2050619&quot;</span>, <span class="string">&quot;2051618&quot;</span>, <span class="string">&quot;2052616&quot;</span>, <span class="string">&quot;2053615&quot;</span>, <span class="string">&quot;2054621&quot;</span>, <span class="string">&quot;2055620&quot;</span>, <span class="string">&quot;2056618&quot;</span>, <span class="string">&quot;2057617&quot;</span>, <span class="string">&quot;2058616&quot;</span>, <span class="string">&quot;2059615&quot;</span>, <span class="string">&quot;2060620&quot;</span>, <span class="string">&quot;2061619&quot;</span>, <span class="string">&quot;2062618&quot;</span>, <span class="string">&quot;2063617&quot;</span>, <span class="string">&quot;2064615&quot;</span>, <span class="string">&quot;2065621&quot;</span>, <span class="string">&quot;2066620&quot;</span>, <span class="string">&quot;2067619&quot;</span>, <span class="string">&quot;2068617&quot;</span>, <span class="string">&quot;2069616&quot;</span>, <span class="string">&quot;2070615&quot;</span>, <span class="string">&quot;2071621&quot;</span>, <span class="string">&quot;2072619&quot;</span>, <span class="string">&quot;2073618&quot;</span>, <span class="string">&quot;2074617&quot;</span>, <span class="string">&quot;2075616&quot;</span>, <span class="string">&quot;2076621&quot;</span>, <span class="string">&quot;2077620&quot;</span>, <span class="string">&quot;2078619&quot;</span>, <span class="string">&quot;2079618&quot;</span>, <span class="string">&quot;2080616&quot;</span>, <span class="string">&quot;2081615&quot;</span>, <span class="string">&quot;2082621&quot;</span>, <span class="string">&quot;2083620&quot;</span>, <span class="string">&quot;2084618&quot;</span>, <span class="string">&quot;2085617&quot;</span>, <span class="string">&quot;2086616&quot;</span>, <span class="string">&quot;2087615&quot;</span>, <span class="string">&quot;2088620&quot;</span>, <span class="string">&quot;2089619&quot;</span>, <span class="string">&quot;2090618&quot;</span>, <span class="string">&quot;2091617&quot;</span>, <span class="string">&quot;2092615&quot;</span>, <span class="string">&quot;2093621&quot;</span>, <span class="string">&quot;2094620&quot;</span>, <span class="string">&quot;2095619&quot;</span>, <span class="string">&quot;2096617&quot;</span>, <span class="string">&quot;2097616&quot;</span>, <span class="string">&quot;2098615&quot;</span>, <span class="string">&quot;2099621&quot;</span>, <span class="string">&quot;2100620&quot;</span>, <span class="string">&quot;2101619&quot;</span>, <span class="string">&quot;2102618&quot;</span>, <span class="string">&quot;2103617&quot;</span>, <span class="string">&quot;2104615&quot;</span>, <span class="string">&quot;2105621&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Date</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> y, m, d;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(Date p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (p.y != y) <span class="keyword">return</span> y &lt; p.y;</span><br><span class="line">        <span class="keyword">if</span> (p.m != m) <span class="keyword">return</span> m &lt; p.m;</span><br><span class="line">        <span class="keyword">return</span> d &lt; p.d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; mq, fq, now;</span><br><span class="line"><span class="function">Date <span class="title">convert</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Date p;</span><br><span class="line">    p.y = (s[<span class="number">0</span>] - <span class="string">&#x27;0&#x27;</span>) * <span class="number">1000</span> + (s[<span class="number">1</span>] - <span class="string">&#x27;0&#x27;</span>) * <span class="number">100</span> + (s[<span class="number">2</span>] - <span class="string">&#x27;0&#x27;</span>) * <span class="number">10</span> + s[<span class="number">3</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    p.m = s[<span class="number">4</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    p.d = (s[<span class="number">5</span>] - <span class="string">&#x27;0&#x27;</span>) * <span class="number">10</span> + s[<span class="number">6</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;now.y, &amp;now.m, &amp;now.d);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">106</span>; j++) &#123;</span><br><span class="line">            Date s = <span class="built_in">convert</span>(MQ[j]);</span><br><span class="line">            <span class="comment">// printf(&quot;%d %d %d\n&quot;, s.y, s.m, s.d);</span></span><br><span class="line">            <span class="keyword">if</span> (now &lt; s) &#123;</span><br><span class="line">                mq = s;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">106</span>; j++) &#123;</span><br><span class="line">            Date s = <span class="built_in">convert</span>(FQ[j]);</span><br><span class="line">            <span class="keyword">if</span> (now &lt; s) &#123;</span><br><span class="line">                fq = s;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Date s;</span><br><span class="line">        <span class="keyword">if</span> (fq &lt; mq) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Father&#x27;s Day: June %d&quot;</span>, fq.d);</span><br><span class="line">            s = fq;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Mother&#x27;s Day: May %d&quot;</span>, mq.d);</span><br><span class="line">            s = mq;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (s.d == <span class="number">11</span> || s.d == <span class="number">12</span> || s.d == <span class="number">13</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;th&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.d % <span class="number">10</span> == <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;st&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.d % <span class="number">10</span> == <span class="number">2</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;nd&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.d % <span class="number">10</span> == <span class="number">3</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;rd&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;th&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;, %d\n&quot;</span>, s.y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>难题分割线（雾</p>
<h3 id="G、血压游戏"><a href="#G、血压游戏" class="headerlink" title="G、血压游戏"></a>G、血压游戏</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;有很多做法，一种很优雅的做法是使用虚树配合DP。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显然只有同一个深度的节点会互相干扰，因此我们只需要按深度讨论，找出同一个深度的节点，建立虚树，然后在上面DP，DP方程很好列。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 200005</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next, to;</span><br><span class="line">&#125; edge[N &lt;&lt; <span class="number">1</span>], es[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n, root, num[N], head[N], cnt = <span class="number">1</span>, gr[N][<span class="number">21</span>], dep[N], sta[N], top, dfn[N], DFN, hs[N], cn = <span class="number">1</span>;</span><br><span class="line">set&lt;<span class="type">int</span>&gt; tmp;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vec[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    edge[cnt].next = head[x], edge[cnt].to = y, head[x] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">adde</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    tmp.<span class="built_in">insert</span>(x), tmp.<span class="built_in">insert</span>(y), es[cn].next = hs[x], es[cn].to = y, hs[x] = cn++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFS</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dfn[x] = ++DFN;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = head[x]; i; i = edge[i].next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dep[edge[i].to]) <span class="keyword">continue</span>;</span><br><span class="line">        dep[edge[i].to] = dep[x] + <span class="number">1</span>, gr[edge[i].to][<span class="number">0</span>] = x;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">20</span>; j++) gr[edge[i].to][j] = gr[gr[edge[i].to][j - <span class="number">1</span>]][j - <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">DFS</span>(edge[i].to);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[x] &lt; dep[y]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">20</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dep[gr[x][i]] &gt; dep[y]) x = gr[x][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x == y) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">20</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (gr[x][i] != gr[y][i]) x = gr[x][i], y = gr[y][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> gr[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (top &lt;= <span class="number">1</span>)</span><br><span class="line">        sta[++top] = x;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> lca = <span class="built_in">LCA</span>(sta[top], x);</span><br><span class="line">        <span class="keyword">if</span> (lca == sta[top])</span><br><span class="line">            sta[++top] = x;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (top &gt; <span class="number">1</span> &amp;&amp; dfn[lca] &lt;= dfn[sta[top - <span class="number">1</span>]]) <span class="built_in">adde</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">            <span class="keyword">if</span> (lca != sta[top]) <span class="built_in">adde</span>(lca, sta[top]), sta[top] = lca;</span><br><span class="line">            sta[++top] = x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">DP</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hs[x] == <span class="number">0</span> &amp;&amp; x != root) <span class="keyword">return</span> num[x];</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> dp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = hs[x]; i; i = es[i].next) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> ch = <span class="built_in">DP</span>(es[i].to);</span><br><span class="line">        <span class="keyword">if</span> (ch) ch = <span class="built_in">max</span>(<span class="number">1ll</span>, ch - (dep[es[i].to] - dep[x]));</span><br><span class="line">        dp += ch;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dfn[x] &lt; dfn[y];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;root);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, num + i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, x, y; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;x, &amp;y), <span class="built_in">add</span>(x, y), <span class="built_in">add</span>(y, x);</span><br><span class="line">    dep[root] = <span class="number">1</span>, <span class="built_in">DFS</span>(root);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) vec[dep[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">sort</span>(vec[i].<span class="built_in">begin</span>(), vec[i].<span class="built_in">end</span>(), cmp);</span><br><span class="line">    ans = num[root] &gt; <span class="number">1</span> ? num[root] - <span class="number">1</span> : num[root];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        sta[top = <span class="number">1</span>] = root, tmp.<span class="built_in">insert</span>(root);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; vec[i].<span class="built_in">size</span>(); j++) <span class="built_in">insert</span>(vec[i][j]);</span><br><span class="line">        <span class="keyword">while</span> (top &gt; <span class="number">1</span>) <span class="built_in">adde</span>(sta[top - <span class="number">1</span>], sta[top]), --top;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> dp = <span class="built_in">DP</span>(root);</span><br><span class="line">        ans += dp &gt; <span class="number">1</span> ? dp - <span class="number">1</span> : dp;</span><br><span class="line">        <span class="keyword">for</span> (set&lt;<span class="type">int</span>&gt;::iterator it = tmp.<span class="built_in">begin</span>(); it != tmp.<span class="built_in">end</span>(); it++) hs[*it] = <span class="number">0</span>;</span><br><span class="line">        cn = <span class="number">1</span>, tmp.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, ans);</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="H、纸牌游戏"><a href="#H、纸牌游戏" class="headerlink" title="H、纸牌游戏"></a>H、纸牌游戏</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;首先需要知道十进制整数能被3整除的充要条件是该整数的各个位数字相加的和能被3整除，问题转化为了数字的和。然后考虑贪心。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;贪心的方法就是从9到0依次遍历，枚举每一个数字能够取的次数，然后判断剩下的数字能否构造出符合题意的数。现在的问题就是如何进行判定。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于枚举的复杂度就是$O(n)$的，判定这一步的复杂度不能到$O(n)$。现在假定数字$i$出现的次数为$a_i$，考虑给定的数字能否找出一种方案，使得选$k$个数，它们的和模3为$p$。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;事实上，0到9这10个数可以分为3类，一类模3为0，另两类模3为1和2，我们不妨只考虑三类数的数量，记为$b_0,b_1,b_2$，显然$b_0=a_0+a_3+a_6+a_9$，$b_1,b_2$同理可以推得。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;假设存在一种方案符合题意，这个方案中三类数分别取了$x,y,z$个，那么可以列出下面的方程：</p>
<script type="math/tex; mode=display">x+y+z=k</script><script type="math/tex; mode=display">y+2z\equiv p\pmod 3</script><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;枚举$y$与$z$模3的性质（共9种情况），对于其中满足方程的数对$(m,n)$，有：</p>
<script type="math/tex; mode=display">y\equiv m\pmod 3\\
z\equiv n\pmod 3\\
y+2z\equiv p\pmod 3</script><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这样可以将$y,z$写成如下形式：</p>
<script type="math/tex; mode=display">y=3k_1+m\\
z=3k_2+n</script><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据$b_1,b_2$，我们很容易推出$k_1,k_2$的取值范围，进而得到$y,z$的取值范围，从而得到$x$的范围。然后判断这一个范围是否满足$b_0$的限制即可。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这样我们就得到了$O(1)$的判定方法，本题迎刃而解。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">check</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> k, <span class="type">int</span> sv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a + b + c &lt; k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((i + <span class="number">2</span> * j) % <span class="number">3</span> != sv) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (b - i &lt; <span class="number">0</span> || c - j &lt; <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> k1 = (b - i) / <span class="number">3</span>, k2 = (c - j) / <span class="number">3</span>;</span><br><span class="line">            <span class="type">double</span> down = (k - i - j - a) / <span class="number">3.0</span>;</span><br><span class="line">            <span class="type">double</span> up = (k - i - j) / <span class="number">3.0</span>;</span><br><span class="line">            <span class="type">int</span> pd = <span class="built_in">ceil</span>(down), pu = <span class="built_in">floor</span>(up);</span><br><span class="line">            <span class="keyword">if</span> (pu &lt; pd) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (k1 + k2 &lt; pd || pu &lt; <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> op[<span class="number">1000005</span>], ans[<span class="number">1000005</span>];</span><br><span class="line"><span class="type">int</span> num[<span class="number">20</span>], k, n0, n1, n2, at;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFS</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> sv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = num[x]; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; k) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (x % <span class="number">3</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            n0 -= num[x];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            n1 -= num[x];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            n2 -= num[x];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(n0, n1, n2, k - i, ((sv - x % <span class="number">3</span> * i) % <span class="number">3</span> + <span class="number">3</span>) % <span class="number">3</span>)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i; j++) ans[at++] = x + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            k -= i;</span><br><span class="line">            <span class="built_in">DFS</span>(x - <span class="number">1</span>, ((sv - x % <span class="number">3</span> * i) % <span class="number">3</span> + <span class="number">3</span>) % <span class="number">3</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x % <span class="number">3</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            n0 += num[x];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            n1 += num[x];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            n2 += num[x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    <span class="comment">// printf(&quot;%d\n&quot;, check(0, 3, 0, 1, 0));</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= t; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, op, &amp;k);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) num[j] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; op[j]; j++) ++num[op[j] - <span class="string">&#x27;0&#x27;</span>];</span><br><span class="line">        n0 = num[<span class="number">0</span>] + num[<span class="number">3</span>] + num[<span class="number">6</span>] + num[<span class="number">9</span>];</span><br><span class="line">        n1 = num[<span class="number">1</span>] + num[<span class="number">4</span>] + num[<span class="number">7</span>];</span><br><span class="line">        n2 = num[<span class="number">2</span>] + num[<span class="number">5</span>] + num[<span class="number">8</span>];</span><br><span class="line">        at = <span class="number">0</span>, <span class="built_in">DFS</span>(<span class="number">9</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (at == <span class="number">0</span> || (ans[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span> &amp;&amp; at != <span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; at; j++) <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, ans[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="I、古老的打字机"><a href="#I、古老的打字机" class="headerlink" title="I、古老的打字机"></a>I、古老的打字机</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;整场比赛我最喜欢的一道题，比较有思维含量。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;要解决本题，需要熟悉AC自动机的相关内容。回想AC自动机中是如何求很多串在一个串内各自的出现次数的：建出AC自动机后，把这一个串丢到AC自动机上跑，记录每一个状态被访问的次数，最后在fail树上一遍DFS统计一波。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于需要最后再fail树上统计，我们不妨直接一开始就进行一遍DFS，将每一个串的权值下放到其在fail树上的子树节点上，这样遍历一遍AC自动机，串的价值就是走过状态权值之和。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;然后本题可以转化为在AC自动机上进行期望DP的问题。DP转移方程还是比较好列的。但是到这一步本题还没有完全解决，这是因为退格操作的存在。退格操作使得我们可能回退一个字符，这样就需要减去权值，对于DP来说需要记额外状态，这显然不可取。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;但是可以退一步想：无论退不退格，在哪里退格，最后得到就是一个串，只不过长度不定。凭借这个思路，可以得到一个方法：对于固定长度为$p$的串，禁止使用退格操作（下一步填每一个字母的概率都是$\frac {1}{26}$），得到期望$e_p$，如果再记算上退格操作得到的长度为$p$的串概率为$f_i$，那么答案就是：</p>
<script type="math/tex; mode=display">\sum_{i=0}^mf_ie_i</script><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;问题转化为求$f$，然而这并不是一个简单的二项分布问题，求$f$仍然需要DP，比较常规。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本题同时考察了AC自动机（含fail树），期望概率DP以及一丁点数论（乘法逆元），兼具思维性，给出题人点赞。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">char</span> str[N], op[N];</span><br><span class="line"><span class="type">int</span> vis[N], to[N], ct = <span class="number">1</span>, fail[N], tr[N][<span class="number">26</span>], cnt = <span class="number">1</span>, v[N], n, m, fa[N], head[N], dp[N][N];</span><br><span class="line"><span class="type">int</span> inv26, inv27, f[N][N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next, to;</span><br><span class="line">&#125; edge[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    edge[cnt].to = y, edge[cnt].next = head[x], head[x] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">qPow</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y = MOD - <span class="number">2</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>, sta = x;</span><br><span class="line">    <span class="keyword">while</span> (y) &#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>) ans = <span class="number">1ll</span> * sta * ans % MOD;</span><br><span class="line">        sta = <span class="number">1ll</span> * sta * sta % MOD, y &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line">queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* p, <span class="type">int</span> ps)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, now = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p[i]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tr[now][p[i] - <span class="string">&#x27;a&#x27;</span>] == <span class="number">0</span>) tr[now][p[i] - <span class="string">&#x27;a&#x27;</span>] = ++ct;</span><br><span class="line">        now = tr[now][p[i] - <span class="string">&#x27;a&#x27;</span>], i++;</span><br><span class="line">    &#125;</span><br><span class="line">    v[now] += ps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFS</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    v[x] += s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = head[x]; i; i = edge[i].next) <span class="built_in">DFS</span>(edge[i].to, v[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">DP</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) <span class="keyword">return</span> dp[x][c] = v[x];</span><br><span class="line">    <span class="keyword">if</span> (~dp[x][c]) <span class="keyword">return</span> dp[x][c];</span><br><span class="line">    dp[x][c] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">        dp[x][c] = (dp[x][c] + <span class="number">1ll</span> * (v[x] + <span class="built_in">DP</span>(tr[x][i], c - <span class="number">1</span>)) * inv26 % MOD) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[x][c];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m), inv26 = <span class="built_in">qPow</span>(<span class="number">26</span>), inv27 = <span class="built_in">qPow</span>(<span class="number">27</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, x; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, op, &amp;x), <span class="built_in">insert</span>(op, x);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) tr[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">    que.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> p = que.<span class="built_in">front</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (tr[p][i])</span><br><span class="line">                fail[tr[p][i]] = tr[fail[p]][i], que.<span class="built_in">push</span>(tr[p][i]);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                tr[p][i] = tr[fail[p]][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= ct; i++) <span class="built_in">add</span>(fail[i], i);</span><br><span class="line">    <span class="built_in">DFS</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="built_in">memset</span>(dp, <span class="number">-1</span>, <span class="built_in">sizeof</span>(dp)), f[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        f[i][<span class="number">0</span>] = <span class="number">1ll</span> * (f[i - <span class="number">1</span>][<span class="number">1</span>] + f[i - <span class="number">1</span>][<span class="number">0</span>]) * inv27 % MOD;</span><br><span class="line">        f[i][m] = <span class="number">1ll</span> * f[i - <span class="number">1</span>][m - <span class="number">1</span>] * (<span class="number">1</span> - inv27) % MOD;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; m; j++) &#123;</span><br><span class="line">            f[i][j] = (<span class="number">1ll</span> * f[i - <span class="number">1</span>][j - <span class="number">1</span>] * (<span class="number">1</span> - inv27) % MOD + <span class="number">1ll</span> * f[i - <span class="number">1</span>][j + <span class="number">1</span>] * inv27 % MOD) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; i++) ans = (ans + <span class="number">1ll</span> * f[m][i] * <span class="built_in">DP</span>(<span class="number">1</span>, i) % MOD) % MOD;</span><br><span class="line">    ans = <span class="number">1ll</span> * ans * <span class="built_in">qPow</span>(<span class="number">27</span>, m) % MOD;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, (ans + MOD) % MOD);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="J、能到达吗"><a href="#J、能到达吗" class="headerlink" title="J、能到达吗"></a>J、能到达吗</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;一个<del>傻</del>搜索，不过数据范围过大。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于障碍物很少，但是图很大，可以将一大片的点合并，然后用并查集合并求解。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;合并节点的方法是对于存在障碍物的一行，将这一行按障碍物分开，对于连续的没有障碍物的若干行，将它们合并成一个。这样做能将块的复杂度降到$O(k)$。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本题细节较多。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 4000005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n, m, k, fa[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vec[N &gt;&gt; <span class="number">2</span>], up, down, l, r;</span><br><span class="line">vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; num;</span><br><span class="line">set&lt;<span class="type">int</span>&gt; ssp;</span><br><span class="line"><span class="type">int</span> inv2 = <span class="number">500000004</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ff</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fa[x] == x ? x : fa[x] = <span class="built_in">ff</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">ff</span>(x) == <span class="built_in">ff</span>(y)) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> f1 = <span class="built_in">ff</span>(x), f2 = <span class="built_in">ff</span>(y);</span><br><span class="line">    fa[f1] = f2, num[f2] += num[f1], num[f2] %= MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">les</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> up[y] &gt; down[x] + <span class="number">1</span> || (up[y] == down[x] + <span class="number">1</span> &amp;&amp; l[y] &gt; r[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ok</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> up[y] == down[x] + <span class="number">1</span> &amp;&amp; l[y] &lt;= r[x] &amp;&amp; r[y] &gt;= l[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findL</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r)</span>  <span class="comment">//(,]</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (r == l + <span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">ok</span>(x, r) ? r : <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">les</span>(x, mid) || <span class="built_in">ok</span>(x, mid)) <span class="keyword">return</span> <span class="built_in">findL</span>(x, l, mid);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">findL</span>(x, mid, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findR</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r)</span>  <span class="comment">//[,)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (r == l + <span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">ok</span>(x, l) ? l : <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">les</span>(x, mid)) <span class="keyword">return</span> <span class="built_in">findR</span>(x, mid, r);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">findR</span>(x, l, mid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;k);</span><br><span class="line">        up.<span class="built_in">clear</span>(), down.<span class="built_in">clear</span>(), l.<span class="built_in">clear</span>(), r.<span class="built_in">clear</span>(), num.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, x, y; i &lt;= k; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;x, &amp;y), vec[x].<span class="built_in">push_back</span>(y), ssp.<span class="built_in">insert</span>(x);</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : ssp) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; now) &#123;</span><br><span class="line">                num.<span class="built_in">push_back</span>(<span class="number">1ll</span> * (i - now) * m % MOD);</span><br><span class="line">                up.<span class="built_in">push_back</span>(now), down.<span class="built_in">push_back</span>(i - <span class="number">1</span>), l.<span class="built_in">push_back</span>(<span class="number">1</span>), r.<span class="built_in">push_back</span>(m);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">sort</span>(vec[i].<span class="built_in">begin</span>(), vec[i].<span class="built_in">end</span>());</span><br><span class="line">            <span class="type">int</span> sv = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; vec[i].<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (vec[i][j] - sv &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    up.<span class="built_in">push_back</span>(i), down.<span class="built_in">push_back</span>(i);</span><br><span class="line">                    l.<span class="built_in">push_back</span>(sv), r.<span class="built_in">push_back</span>(vec[i][j] - <span class="number">1</span>), num.<span class="built_in">push_back</span>(vec[i][j] - sv);</span><br><span class="line">                &#125;</span><br><span class="line">                sv = vec[i][j] + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (m - sv + <span class="number">1</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                up.<span class="built_in">push_back</span>(i), down.<span class="built_in">push_back</span>(i);</span><br><span class="line">                l.<span class="built_in">push_back</span>(sv), r.<span class="built_in">push_back</span>(m), num.<span class="built_in">push_back</span>(m - sv + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            now = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n - now + <span class="number">1</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            up.<span class="built_in">push_back</span>(now), down.<span class="built_in">push_back</span>(n);</span><br><span class="line">            l.<span class="built_in">push_back</span>(<span class="number">1</span>), r.<span class="built_in">push_back</span>(m), num.<span class="built_in">push_back</span>(<span class="number">1ll</span> * (n - now + <span class="number">1</span>) * m % MOD);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; up.<span class="built_in">size</span>(); i++) fa[i] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; up.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="type">int</span> l = <span class="built_in">findL</span>(i, i, up.<span class="built_in">size</span>() - <span class="number">1</span>), r = <span class="built_in">findR</span>(i, i + <span class="number">1</span>, up.<span class="built_in">size</span>());</span><br><span class="line">            <span class="keyword">if</span> (l != <span class="number">-1</span>)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = l; j &lt;= r; j++) <span class="built_in">merge</span>(i, j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; up.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fa[i] == i) ans += <span class="number">1ll</span> * num[i] * (num[i] + <span class="number">1</span>) % MOD * inv2 % MOD, ans %= MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : ssp) vec[i].<span class="built_in">clear</span>();</span><br><span class="line">        ssp.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="K、迷宫"><a href="#K、迷宫" class="headerlink" title="K、迷宫"></a>K、迷宫</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这题出的还是很有技术含量的。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;可以预见的是只要$d$不是0，那么合理使用穿越一定不会使答案更差。于是我们对$d=0$特判，对$d&gt;0$的情况默认都使用一次穿越。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;下一步从起点来一遍BFS，再从终点来一遍BFS，对于某一个点$p$，前者求出的距离记为$dis(p,1)$，后者记为$dis(p,2)$。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;问题转化为找两个点$p,q$（两个点可以互相穿越），使得$dis(p,1)+1+dis(q,2)$尽可能小。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;强行遍历显然不可取。考虑一下切比雪夫距离，正好是一个正方形的范围，这样问题转化为在一个正方形区域中求最小值问题，即一个二维RMQ问题。二维RMQ问题有很多方法解决，但是这里不能用二维ST表，因为它空间复杂度是$O(nmlognlogm)$，会炸空间。用阉割版（只能求正方形范围）的ST表（时空复杂度为$O(nmlog(\min(n,m)))$）或许可以，不过不推荐。最好的做法是使用单调队列，可以在时空复杂度$O(nm)$下解决这个问题。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 2005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> inf 0x3f3f3f3f</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n, m, d, bx, by, ex, ey, dis[N][N][<span class="number">2</span>], minn[N][N], minn2[N][N];</span><br><span class="line"><span class="type">char</span> op[N][N];</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> X[] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;, Y[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; que;</span><br><span class="line">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; fr[N][N][<span class="number">2</span>];</span><br><span class="line">deque&lt;<span class="type">int</span>&gt; dq;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">BFS</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> at)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    que.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(x, y)), dis[x][y][at] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; now = que.<span class="built_in">front</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, xx, yy; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            xx = now.first + X[i], yy = now.second + Y[i];</span><br><span class="line">            <span class="keyword">if</span> (xx &lt; <span class="number">0</span> || xx &gt;= n || yy &lt; <span class="number">0</span> || yy &gt;= m || op[xx][yy] == <span class="string">&#x27;X&#x27;</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (dis[xx][yy][at] &gt; dis[now.first][now.second][at] + <span class="number">1</span>) &#123;</span><br><span class="line">                dis[xx][yy][at] = dis[now.first][now.second][at] + <span class="number">1</span>;</span><br><span class="line">                fr[xx][yy][at] = now;</span><br><span class="line">                que.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(xx, yy));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FDFS</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == bx &amp;&amp; y == by) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, bx, by);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">FDFS</span>(fr[x][y][<span class="number">0</span>].first, fr[x][y][<span class="number">0</span>].second);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, x, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFS</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == ex &amp;&amp; y == ey) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, x, y);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, x, y);</span><br><span class="line">        <span class="built_in">DFS</span>(fr[x][y][<span class="number">1</span>].first, fr[x][y][<span class="number">1</span>].second);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addX</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!dq.<span class="built_in">empty</span>() &amp;&amp; dis[x][dq.<span class="built_in">back</span>()][<span class="number">1</span>] &gt; dis[x][y][<span class="number">1</span>]) dq.<span class="built_in">pop_back</span>();</span><br><span class="line">    dq.<span class="built_in">push_back</span>(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addY</span><span class="params">(<span class="type">int</span> y, <span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!dq.<span class="built_in">empty</span>() &amp;&amp; minn[dq.<span class="built_in">back</span>()][y] &gt; minn[x][y]) dq.<span class="built_in">pop_back</span>();</span><br><span class="line">    dq.<span class="built_in">push_back</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getQ</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!dq.<span class="built_in">empty</span>() &amp;&amp; dq.<span class="built_in">front</span>() &lt; p) dq.<span class="built_in">pop_front</span>();</span><br><span class="line">    <span class="keyword">return</span> dq.<span class="built_in">front</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;d);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op + i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (op[i][j] == <span class="string">&#x27;S&#x27;</span>) bx = i, by = j;</span><br><span class="line">            <span class="keyword">if</span> (op[i][j] == <span class="string">&#x27;T&#x27;</span>) ex = i, ey = j;</span><br><span class="line">            dis[i][j][<span class="number">0</span>] = dis[i][j][<span class="number">1</span>] = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">BFS</span>(bx, by, <span class="number">0</span>), <span class="built_in">BFS</span>(ex, ey, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (d == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dis[ex][ey][<span class="number">0</span>] &gt;= inf) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dis[ex][ey][<span class="number">0</span>]);</span><br><span class="line">            <span class="built_in">FDFS</span>(ex, ey);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, at; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!dq.<span class="built_in">empty</span>()) dq.<span class="built_in">pop_back</span>();</span><br><span class="line">        at = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (at &lt;= d &amp;&amp; at &lt; m) <span class="built_in">addX</span>(i, at++);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (at &lt;= j + d &amp;&amp; at &lt; m) <span class="built_in">addX</span>(i, at++);</span><br><span class="line">            minn[i][j] = dis[i][<span class="built_in">getQ</span>(<span class="built_in">max</span>(<span class="number">0</span>, j - d))][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, at; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (!dq.<span class="built_in">empty</span>()) dq.<span class="built_in">pop_back</span>();</span><br><span class="line">        at = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (at &lt;= d &amp;&amp; at &lt; n) <span class="built_in">addY</span>(i, at++);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (at &lt;= j + d &amp;&amp; at &lt; n) <span class="built_in">addY</span>(i, at++);</span><br><span class="line">            minn2[j][i] = minn[<span class="built_in">getQ</span>(<span class="built_in">max</span>(<span class="number">0</span>, j - d))][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = inf, tx, ty;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">            <span class="type">int</span> get = minn2[i][j];</span><br><span class="line">            <span class="keyword">if</span> (dis[i][j][<span class="number">0</span>] + <span class="number">1</span> + get &lt; ans) &#123;</span><br><span class="line">                ans = dis[i][j][<span class="number">0</span>] + <span class="number">1</span> + get;</span><br><span class="line">                tx = i, ty = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ans &gt;= inf) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">        <span class="built_in">FDFS</span>(tx, ty);</span><br><span class="line">        <span class="type">int</span> get = minn2[tx][ty];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="built_in">max</span>(<span class="number">0</span>, tx - d); i &lt;= <span class="built_in">min</span>(n - <span class="number">1</span>, tx + d); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="built_in">max</span>(<span class="number">0</span>, ty - d); j &lt;= <span class="built_in">min</span>(m - <span class="number">1</span>, ty + d); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dis[i][j][<span class="number">1</span>] == get) &#123;</span><br><span class="line">                    <span class="built_in">DFS</span>(i, j);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="L、动物森友会"><a href="#L、动物森友会" class="headerlink" title="L、动物森友会"></a>L、动物森友会</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后六道题中最简单的一道，放最后了（毒瘤。方法是二分答案配合网络流。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;二分出一个答案，然后建网络流图，答案判定就看最大流看是否满流即可。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> inf 0x3f3f3f3f</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 2000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> to, next, v;</span><br><span class="line">&#125; edge[<span class="number">20005</span>];</span><br><span class="line"><span class="type">int</span> head[N], cnt = <span class="number">0</span>, n, b, e, deep[N], cur[N] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    edge[cnt].to = y, edge[cnt].next = head[x], edge[cnt].v = z, head[x] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">DFS</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> limit)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (limit == <span class="number">0</span> || x == e) <span class="keyword">return</span> limit;</span><br><span class="line">    <span class="type">int</span> f, flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = cur[x]; ~i; i = edge[i].next) &#123;</span><br><span class="line">        cur[x] = i;</span><br><span class="line">        <span class="keyword">if</span> (deep[edge[i].to] == deep[x] + <span class="number">1</span> &amp;&amp; (f = <span class="built_in">DFS</span>(edge[i].to, <span class="built_in">min</span>(limit, edge[i].v)))) &#123;</span><br><span class="line">            edge[i].v -= f, edge[i ^ <span class="number">1</span>].v += f, flow += f, limit -= f;</span><br><span class="line">            <span class="keyword">if</span> (!limit) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">BFS</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) que.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) deep[i] = n, cur[i] = head[i];</span><br><span class="line">    deep[b] = <span class="number">0</span>, que.<span class="built_in">push</span>(b);</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> f = que.<span class="built_in">front</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[f]; ~i; i = edge[i].next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (edge[i].v &gt; <span class="number">0</span> &amp;&amp; deep[edge[i].to] == n) &#123;</span><br><span class="line">                deep[edge[i].to] = deep[f] + <span class="number">1</span>, que.<span class="built_in">push</span>(edge[i].to);</span><br><span class="line">                <span class="keyword">if</span> (edge[i].to == e) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> deep[e] != n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> events, li, c[<span class="number">1005</span>], os[<span class="number">7</span>][<span class="number">1005</span>], sum;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) head[i] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">7</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">add</span>(b, i + <span class="number">1</span>, <span class="built_in">min</span>(<span class="number">1ll</span> * x / <span class="number">7</span> * li + (i &lt;= x % <span class="number">7</span> ? li : <span class="number">0</span>), <span class="number">1ll</span> * sum)), <span class="built_in">add</span>(i + <span class="number">1</span>, b, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= os[i][<span class="number">0</span>]; j++) &#123;</span><br><span class="line">            <span class="built_in">add</span>(i + <span class="number">2</span>, <span class="number">8</span> + os[i][j], sum);</span><br><span class="line">            <span class="built_in">add</span>(<span class="number">8</span> + os[i][j], i + <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= events; i++) <span class="built_in">add</span>(<span class="number">8</span> + i, e, c[i]), <span class="built_in">add</span>(e, <span class="number">8</span> + i, <span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">BFS</span>()) flow += <span class="built_in">DFS</span>(b, inf);</span><br><span class="line">    <span class="keyword">return</span> flow == sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;events, &amp;li);</span><br><span class="line">    n = <span class="number">2</span> + <span class="number">7</span> + events, b = <span class="number">1</span>, e = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, p; i &lt;= events; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, c + i, &amp;p), sum += c[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>, x; j &lt;= p; j++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">            os[x - <span class="number">1</span>][++os[x - <span class="number">1</span>][<span class="number">0</span>]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = <span class="number">700000000</span>, mid;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">        <span class="keyword">if</span> (r == l + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, r);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) &#123;</span><br><span class="line">            r = mid;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            l = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// PAUSE;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

    </div>

    <div>全文完。</div>
  </article>
  <div class="toc-container">
    
  <div id="toc" class="toc-article">
    <strong class="toc-title">Posts</strong>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#A%E3%80%81%E7%BB%84%E9%98%9F%E6%AF%94%E8%B5%9B"><span class="toc-text">A、组队比赛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B%E3%80%81%E6%AF%8F%E6%97%A5%E4%B8%80%E6%8A%A5"><span class="toc-text">B、每日一报</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C%E3%80%81%E6%9C%80%E9%95%BF%E9%9D%9E%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97"><span class="toc-text">C、最长非公共子序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#D%E3%80%81%E6%9C%80%E5%A4%A7%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="toc-text">D、最大字符集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#E%E3%80%81%E7%BE%8E%E5%91%B3%E7%9A%84%E5%BA%8F%E5%88%97"><span class="toc-text">E、美味的序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#F%E3%80%81%E6%97%A5%E6%9C%9F%E5%B0%8F%E5%8A%A9%E6%89%8B"><span class="toc-text">F、日期小助手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G%E3%80%81%E8%A1%80%E5%8E%8B%E6%B8%B8%E6%88%8F"><span class="toc-text">G、血压游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#H%E3%80%81%E7%BA%B8%E7%89%8C%E6%B8%B8%E6%88%8F"><span class="toc-text">H、纸牌游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#I%E3%80%81%E5%8F%A4%E8%80%81%E7%9A%84%E6%89%93%E5%AD%97%E6%9C%BA"><span class="toc-text">I、古老的打字机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#J%E3%80%81%E8%83%BD%E5%88%B0%E8%BE%BE%E5%90%97"><span class="toc-text">J、能到达吗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#K%E3%80%81%E8%BF%B7%E5%AE%AB"><span class="toc-text">K、迷宫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#L%E3%80%81%E5%8A%A8%E7%89%A9%E6%A3%AE%E5%8F%8B%E4%BC%9A"><span class="toc-text">L、动物森友会</span></a></li></ol>
  </div>


  </div>
</div>
<div class="copyright">
    <span>本作品采用</span>
    <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a>
    <span>进行许可。 转载时请注明原文链接。</span>
</div>
  
      
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>〈 </span>
          <a href="/2020/02/14/Educational-Codeforces-Round-82-Rated-for-Div-2/" rel="next" title="Educational Codeforces Round 82">
          Educational Codeforces Round 82
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
          
          <a href="/2020/04/22/%E4%BB%8E%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%88%B0GNN/" rel="prev" title="从神经网络到GNN">
            从神经网络到GNN
          </a>
          <span>〉</span>
        
      </div>
    </div>
  
      
    </div>

    

  </div>
  <footer class="footer text-center">
    <div id="bottom-inner">
        <a class="bottom-item" href="https://twifor.github.io">首页</a> |
        <a class="bottom-item" href="https://twifor.github.io/index_original.html" target="_blank">主站</a> |
        <a class="bottom-item" href="https://github.com/Twifor" target="_blank">GitHub</a> |
        <a class="bottom-item" href="https://hexo.io" target="_blank">Powered by hexo</a> |
        <a class="bottom-item" href="https://github.com/KevinOfNeu/hexo-theme-xoxo" target="_blank">Theme xoxo</a>
    </div>
</footer>
  

<script>
  (function(window, document, undefined) {

    var timer = null;

    function returnTop() {
      cancelAnimationFrame(timer);
      timer = requestAnimationFrame(function fn() {
        var oTop = document.body.scrollTop || document.documentElement.scrollTop;
        if (oTop > 0) {
          document.body.scrollTop = document.documentElement.scrollTop = oTop - 50;
          timer = requestAnimationFrame(fn);
        } else {
          cancelAnimationFrame(timer);
        }
      });
    }

    var hearts = [];
    window.requestAnimationFrame = (function() {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          setTimeout(callback, 1000 / 60);
        }
    })();
    init();

    function init() {
      css(".heart{z-index:9999;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
      attachEvent();
      gameloop();
      addMenuEvent();
    }

    function gameloop() {
      for (var i = 0; i < hearts.length; i++) {
        if (hearts[i].alpha <= 0) {
          document.body.removeChild(hearts[i].el);
          hearts.splice(i, 1);
          continue;
        }
        hearts[i].y--;
        hearts[i].scale += 0.004;
        hearts[i].alpha -= 0.013;
        hearts[i].el.style.cssText = "left:" + hearts[i].x + "px;top:" + hearts[i].y + "px;opacity:" + hearts[i].alpha + ";transform:scale(" + hearts[i].scale + "," + hearts[i].scale + ") rotate(45deg);background:" + hearts[i].color;
      }
      requestAnimationFrame(gameloop);
    }

    /**
     * 给logo设置点击事件
     * 
     * - 回到顶部
     * - 出现爱心
     */
    function attachEvent() {
      var old = typeof window.onclick === "function" && window.onclick;
      var logo = document.getElementById("logo");
      if (logo) {
        logo.onclick = function(event) {
          returnTop();
          old && old();
          createHeart(event);
        }
      }
      
    }

    function createHeart(event) {
      var d = document.createElement("div");
      d.className = "heart";
      hearts.push({
        el: d,
        x: event.clientX - 5,
        y: event.clientY - 5,
        scale: 1,
        alpha: 1,
        color: randomColor()
      });
      document.body.appendChild(d);
    }

    function css(css) {
      var style = document.createElement("style");
      style.type = "text/css";
      try {
        style.appendChild(document.createTextNode(css));
      } catch (ex) {
        style.styleSheet.cssText = css;
      }
      document.getElementsByTagName('head')[0].appendChild(style);
    }

    function randomColor() {
      // return "rgb(" + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + ")";
      return "#F44336";
    }

    function addMenuEvent() {
      var menu = document.getElementById('menu-main-post');
      if (menu) {
        var toc = document.getElementById('toc');
        if (toc) {
          menu.onclick = function() {
            if (toc) {
              if (toc.style.display == 'block') {
                toc.style.display = 'none';
              } else {
                toc.style.display = 'block';
              }
            }
          };
        } else {
          menu.style.display = 'none';
        }
      }
    }

  })(window, document);
</script>

  



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        },
        showMathMenu: false,
        "HTML-CSS": {
            preferredFont: "TeX", 
            availableFonts: ["STIX","TeX"],
            showMathMenuMSIE: false
        },
        showProcessingMessages: false,
        messageStyle: "none"
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>
